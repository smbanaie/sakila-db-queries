## کار با مای اسکیوال - دیتابیس فروش فیلم سکیلا

- ماریا دی را از [این آدرس ](https://downloads.mariadb.org/)دانلود  و نصب کنید (نسخه msi) - هنگام نصب پسورد یوزر root را یک پسورد ساده  مانند 123456‌ بگذارید و تیک Use UTF8 as default server's character set  را بزنید که همیشه به صورت پیش فرض دیتابیس ها با یونیکد ساخته شوند و  مشکلی از لحاظ ذخیره داده های فارسی نداشته باشند.
- بقیه مراحل نصب  را به صورت پیش فرض پیش بروید تا ماریا دی بی که یک نسخه تغییر یافته و  رایگان از MySQL‌ است، نصب شود. همراه با ماریا دی بی، نرم افزار HeidiSQL‌  هم نصب می شود که به کمک آن می توانید به انواع دیتابیس‌های رایج مانند  ماریا دی بی، اس کیوالایت، اس کیو ال سرور، پستگرس و مانند آن وصل شوید و  دستورات SQL‌ را اجرا کنید. 
- نرم افزار HeidiSQL‌ را باز کرده،  یک کانکشن جدید به مای اسکیو ال ایجاد کنید. تنها کافی است که پسورد روت  را وارد کنید و بقیه پیش فرض را به همان صورت باقی بگذارید.
- حال از [این آدرس ](https://raw.githubusercontent.com/ivanceras/sakila/master/mysql-sakila-db/sakila-schema.sql)فایل  sakila-schema را دانلود کرده از منوی File‌ گزینه Load SQL File‌ را زده و  فایل فوق را بارگذاری کنید.قبل از اجرا در خط ۲۸۶ به جای BLOB‌ عبارت  LONGBLOB را وارد کنید تا هنگام ایمپورت داده‌ها با خطا مواجه نشوید. سپس  آیکون مثلث آبی یا همان اجرا را بزنید تا دیتابیس سکیلا و جداول آن ساخته  شود. آیکون رفرش را بزنید تا دیتابیس جدید ،‌نمایش داده شود. 
- فایل SQL‌ **داده های سکیلا** را هم مشابه روش فوق از [این آدرس](https://raw.githubusercontent.com/ivanceras/sakila/master/mysql-sakila-db/sakila-data.sql)  دانلود و اجرا کنید تا داده‌های جداول به صورت خودکار اینزرت شود. بعد از  درج داده ها روی دیتابیس سکیلا گزینه رفرش را که بزنید باید حدود ۶.۶  مگابایت حجم دیتابیس در کنار نام سکیلا به شما نمایش داده شود. 
- متاسفانه امکان مشاهده گرافیکی جداول و روابط بین آنها در HeidiSQL‌ فراهم نیست،‌بنابراین برای مشاهده روابط بین آنها شکل زیر[ ](https://dev.mysql.com/doc/sakila/en/images/sakila-schema.png)استفاده کنید تا بتوانید راحت تر دستورات این تمرین را وارد کنید.



- برای شروع، برخی جداول را باز کنید و داده‌های آنها را مشاهده کنید. (کلیک بر روی هر جدول - مشاهده تب Data)
- در  تمرینات زیر گاهی به برخی توابع خود مای اسکیو ال هم نیاز خواهید داشت.  مثلا دستور زیر از دو تابع upper و  concat استفاده می‌کند و ابتدا دو فیلد  نام و نام خانوادگی را با تابع concat‌ به هم می چسباند (بین آنها یک فضای  خالی هم قرار می‌دهد) و سپس تمام حروف ستون حاصل را بزرگ می کند و نام  ستون را `Actor Name`‌ می گذارد.

```
select upper(concat(first_name, ' ', last_name))   'Actor Name'
from actor;
```



تابع  lower هم حروف یک ستون را کوچک می‌کند. هنگام جستجوی یک نام بهتر است  تمامی نامها را به حروف کوچک و یا بزرگ تبدیل کنید، برای جستجو هم همینکار  را انجام دهید که نتیجه درست به شما برگشت داده شود. سایر توابع مورد نیاز،  به شما داده خواهد شد. 

**خروجی شما فایلی با پسوند sql‌ خواهد بود** 

#### شروع تمرینات : کار با HeidiSQL

- شناسه، نام و نام خانوادگی بازیگری را پیدا کنید که نام او 'Joe‍'‌ است . خروجی باید به صورت زیر باشد :



- تمامی بازیگرانی را بیابید که نام خانوادگی آنها شامل `Gen`‌ باشد : (مطابق تصویر)



- نام  و نام خانوادگی بازیگرانی را بیابید که درون فامیل آنها ، `LI`‌ به کار  رفته باشد. خروجی باید بر اساس فامیل و در صورت برابر بودن فامیل، بر اساس  نام مرتب شده باشد. 



- به  کمک عملگر in‌ شناسه (آی دی) سه کشور Afghanistan, Bangladesh, and China  را به دست آورید. (در شرط، فقط از in‌ استفاده کنید- خروجی مطابق زیر)



- می  خواهیم توصیف کامل هر بازیگر را در جدول اکتور در ستونی جدید به نام  description ذخیره کنیم. با کمک دستور `alter table`‌ جدول بازیگر را تغییر  داده و نوع ستون جدید را TEXT‌ یا CLOB‌ بگیرید. خروجی دستور سلکت جدول  بازیگر باید شبیه زیر باشد : 



- می  خواهیم ببنیم هر نام خانوادگی، متعلق به چند نفر است یا به عبارتی هر نام  خانوادگی بین چند تا بازیگر مشترک است. خروجی را بر اساس بیشترین تکرار نام  خانوادگی مرتب کنید. مطابق زیر که داده های ابتدایی خروجی را نشان میدهد:



- دستور فوق را به گونه ای باز نویسی کنید که تنها بازیگرانی که نامشان بیشتر از یک بار تکرار شده است، نمایش داده شوند. 
- به  جای بازیگر HARPO WILLIAMS اشتباها وارد کرده ایم : GROUCHO WILLIAMS .  دستوری بنویسید که این اشتباه را اصلاح کند. خروجی جدول بعد از اصلاح به  صورت زیر باید باشد : 



- دستور SHOW CREATE TABLE address; چه چیزی را نمایش می دهد ؟ فیلد last_update‌ آن چگونه و چه مقداری به خود میگیرد ؟
- می  خواهیم اطلاعات کارمندان این شرکت به همراه اطلاعات آدرس آنها را نمایش  دهیم (مطابق ستون های زیر) . با استفاده از ضرب دکارتی دو جدول staff‌ و  address‌ خروجی زیر را به دست آورید : 



- می  خواهیم مجموع فروش هر کارمند در ماه آگوست ۲۰۰۵ را به دست آوریم . خروجی  باید جدولی مطابق زیر باشد (توضیح از تابع month برای یافتن ماه یک ستون از  نوع تاریخ و از year‌ برای یافتن سال یک ستون در شرط استفاده کنید - خروجی  هر دو تابع فوق، یک عدد است)



- می  خواهیم هر فیلم و تعداد بازیگرانی که در آن بازی کرده اند را به صورت زیر  نمایش دهیم. چه دستوری باید بنویسیم ؟ (توضیح اینکه از ضرب دکارتی دو جدول  فیلم و بازیگران فیلم استفاده کنید)



- چه تعداد از فیلم Hunchback Impossible در این فروشگاه موجود است ؟ (ضرب دکارتی دو جدول Inventory‌ و Film)

![img](http://elearn.buqaen.ac.ir/pluginfile.php/7682/mod_assign/intro/6d.png)

- می  خواهیم لیستی تهیه کنیم از مشتریان (customer) و جمع پرداختی های آنها  (payment) که خروجی بر اساس نام خانوادگی مشتریان مرتب شده باشد (ضرب  دکارتی دو جدول فوق)



- تمام  فیلم‌هایی را بیابید که نامشان با K‌ یا Q‌ شروع بشود و زبان آنها هم  انگلیسی (English) باشد. (از ضرب دکارتی استفاده نکنید / از کوئری های تو  در تو در قسمت شرط برای یافتن زبانی با نام English‌ استفاده کنید ) -  خروجی بر اساس عنوان فیلم باید مرتب باشد. 

- بدون  استفاده از ضرب دکارتی و به کمک کوئری های تو در تو، تمام بازیگرانی که در  فیلم `Alone Trip` بازی کرده اند را بیابید. مطابق زیر : 

- می  خواهیم برای تمامی مشتریان کانادایی فروشگاه یک ایمیل بفرستیم. بدون  استفاده از جوین یا ضرب دکارتی و با استفاده از کوئری های تو در تو، نام،  فامیل و ایمیل این مشتریان را پیدا کنید. توضیح اینکه جدول آدرس، حاوی نام  شهر و هر شهر هم حاوی کد کشور است. خروجی مطابق اسامی زیر باید باشد :‌

- بدون استفاده از جوین و ضرب دکارتی، فیلم‌های خانوادگی (گروه آنها باید family  باشد) را به کاربر نمایش دهید. مطابق خروجی زیر : 

- مطابق  شکل زیر، با هر روشی که میتوانید، فیملهایی که بیشترین کرایه را داشته اند  لیست کنید / به ترتیب نزولی میزان کرایه آنها / فیلمهایی در خروجی ظاهر  شوند که بالای ده بار کرایه شده اند : 

- می خواهیم ببینیم هر فروشگاه ما چقدر تابحال فروش داشته است (میزان دریافتی Payment از مشتریان) . خروجی زیر را تولید کنید : 

- دستور فوق را طوری تغییر دهید که شهر و کشور هر فروشگاه هم نمایش داده شود : 

- می  خواهیم ببینیم کدام گروه فیلم (کدام ژانر) بیشترین درآمد را برای ما به  ارمغان آورده است. پنج ژانر پرفروش را به ترتیب درآمد، نمایش دهید. توضیح  اینکه دستور limit 5 در انتهای دستور، بعد از مرتب سازی ، پنج رکورد بالای  نتایج را نشان می دهد. :